---
layout: compress
---

{% include base_path %}

<!doctype html>
<html lang="{{ site.locale | slice: 0,2 }}" class="no-js" data-theme="dark">
  <head>
    {% include head.html %}
    {% include head/custom.html %}

    <style>
      html, body {
        margin: 0;
        height: 100%;
        background: transparent;
      }

      /* Canvas étoilé 2D */
      #starfield {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -2;
        pointer-events: none;
      }

      /* Globe container—we size it in JS */
      #globe-container {
        position: fixed;
        top: 0; left: 0;
        z-index: -1;
        pointer-events: none;
        overflow: hidden;
      }

      /* Make page backgrounds transparent */
      .page, .page__content, .page__footer,
      .masthead, .initial-content {
        background: transparent !important;
      }

      /* Ensure any <canvas> is displayed as block */
      canvas { display: block; }
    </style>
  </head>

  <body>
    <!-- Etoiles filantes 2D -->
    <canvas id="starfield"></canvas>
    <!-- Globe Three.js -->
    <div id="globe-container"></div>

    {% include browser-upgrade.html %}
    {% include masthead.html %}
    {{ content }}
    <div class="page__footer">
      <footer>
        {% include footer/custom.html %}
        {% include footer.html %}
      </footer>
    </div>

    {% include scripts.html %}

    <!-- Globe Three.js (coloré + nuages) -->
    <script type="module" crossorigin>
      import * as THREE from 'https://unpkg.com/three@0.155.0/build/three.module.js?module';
      import { OrbitControls } from 'https://unpkg.com/three@0.155.0/examples/jsm/controls/OrbitControls.js?module';

      // 1) Grab the container
      const container = document.getElementById('globe-container');

      // 2) Scene, camera, renderer
      const scene  = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, 1, 0.1, 1000);
      camera.position.z = 2.5;

      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      container.appendChild(renderer.domElement);

      // 3) Resize helper: 50% of the smaller viewport dimension, centered
      function resizeGlobeHalfScreen() {
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        const size = Math.floor(Math.min(vw, vh) * 0.5);

        // 1) BUFFER size = CSS size × DPR
        const dpr = window.devicePixelRatio || 1;
        renderer.setPixelRatio(dpr);
        renderer.setSize(size * dpr, size * dpr, false);

        // 2) CSS size stays at `size` px
        renderer.domElement.style.width  = size + 'px';
        renderer.domElement.style.height = size + 'px';

        // 3) Center your container
        container.style.width  = size + 'px';
        container.style.height = size + 'px';
        container.style.top    = ((vh - size) / 2) + 'px';
        container.style.left   = ((vw - size) / 2) + 'px';

        // 4) Keep camera square
        camera.aspect = 1;
        camera.updateProjectionMatrix();
      }


      // Call on load, and whenever the window resizes
      resizeGlobeHalfScreen();
      window.addEventListener('resize', resizeGlobeHalfScreen);

      // 4) Build the Earth + clouds
      const loader = new THREE.TextureLoader();
      loader.crossOrigin = 'anonymous';

      const earth = new THREE.Mesh(
        new THREE.SphereGeometry(1, 75, 75),
        new THREE.MeshPhongMaterial({
          map:       loader.load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg'),
          bumpMap:   loader.load('https://unpkg.com/three-globe/example/img/earth-topology.png'),
          bumpScale: 0.02,
          specular:  0x333333,
          shininess: 5
        })
      );
      scene.add(earth);

      // 5) Lighting
      scene.add(new THREE.AmbientLight(0x888888, 0.6));
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
      dirLight.position.set(5, 3, 5);
      scene.add(dirLight);

      // 6) Controls + animate
      const controls = new OrbitControls(camera, renderer.domElement);
      controls.autoRotate      = true;
      controls.autoRotateSpeed = 0.5;
      controls.enableZoom      = false;
      controls.enablePan       = false;

      (function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      })();
    </script>

    <!-- Stars 2D (fixed + meteors) -->
    <script>
      const c = document.getElementById('starfield');
      const ctx = c.getContext('2d');
      let w, h;
      function resizeStars() {
        w = c.width  = window.innerWidth;
        h = c.height = window.innerHeight;
      }
      resizeStars();
      window.addEventListener('resize', resizeStars);

      /* Static stars */
      const staticStars = [];
      for (let i = 0; i < 350; i++) {
        staticStars.push({
          x: Math.random() * w,
          y: Math.random() * h,
          r: Math.random() * 1.2 + 0.2,
          a: Math.random() * 0.5 + 0.5
        });
      }

      /* Shooting stars */
      const meteors = [];
      function spawnMeteor() {
        const y = Math.random() * h * 0.6;
        meteors.push({
          x: -50, y,
          vx: 4 + Math.random() * 3,
          vy: 2 + Math.random() * 1.5,
          life: 0
        });
      }
      setInterval(spawnMeteor, 2000);

      function draw() {
        ctx.clearRect(0, 0, w, h);
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, w, h);

        /* draw static stars */
        ctx.fillStyle = '#fff';
        staticStars.forEach(s => {
          ctx.globalAlpha = s.a;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
          ctx.fill();
        });
        ctx.globalAlpha = 1;

        /* draw shooting stars */
        for (let i = meteors.length - 1; i >= 0; i--) {
          const m = meteors[i];
          m.x += m.vx; m.y += m.vy; m.life++;
          ctx.strokeStyle = `rgba(255,255,255,${1 - m.life/60})`;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(m.x, m.y);
          ctx.lineTo(m.x - 10, m.y - 5);
          ctx.stroke();
          if (m.x > w + 50 || m.y > h + 50 || m.life > 60) meteors.splice(i,1);
        }

        requestAnimationFrame(draw);
      }
      draw();
    </script>
  </body>
</html>
